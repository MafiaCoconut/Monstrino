# ============================================
# ‚Äñ  Monstrino Packages Management (Shared)  ‚Äñ
# ============================================

define SWITCH_DEV
switch-$(1)-dev:
	@echo "üîß Switching $(1) to local editable path..."
	poetry remove $(1) || true
	poetry add --editable $(2)
	@echo "‚úÖ $(1) installed locally (editable)."
endef

define SWITCH_PROD
switch-$(1)-prod:
	@echo "üöÄ Installing $(1) from Git ($(3))..."
	poetry remove $(1) || true
	poetry add git+ssh://$(4)
	@echo "‚úÖ $(1) installed from Git."
endef

PROD_FILE := pyproject.toml
DEV_FILE := pyproject.dev.toml
UV_COMMAND := uv sync
GIT_ASSUME_UNCHANGED := git update-index --assume-unchanged $(PROD_FILE)
GIT_NO_ASSUME_UNCHANGED := git update-index --no-assume-unchanged $(PROD_FILE)

# =================================================================
# 1. –í–ö–õ–Æ–ß–ï–ù–ò–ï / –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï –õ–û–ö–ê–õ–¨–ù–û–ì–û –†–ï–ñ–ò–ú–ê
# =================================================================

# –í–∫–ª—é—á–∞–µ—Ç dev-—Ä–µ–∂–∏–º (–∫–æ–ø–∏—Ä—É–µ—Ç dev-—Ñ–∞–π–ª)
dev-mode-on:
	@echo "üî• –ê–∫—Ç–∏–≤–∞—Ü–∏—è DEV-—Ä–µ–∂–∏–º–∞: –í–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π..."
	@cp $(DEV_FILE) $(PROD_FILE)
	@echo "‚úÖ $(PROD_FILE) —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ DEV-–ø—É—Ç–∏."

# –û—Ç–∫–ª—é—á–∞–µ—Ç dev-—Ä–µ–∂–∏–º (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç prod-—Ñ–∞–π–ª –∏–∑ Git)
dev-mode-off:
	@echo "üßä –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è DEV-—Ä–µ–∂–∏–º–∞: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ PROD-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
	@git checkout -- $(PROD_FILE)
	@echo "‚úÖ $(PROD_FILE) –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ Git."

# =================================================================
# 2. –ê–í–¢–û–ú–ê–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –ö–û–ú–ê–ù–î–´ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò
# =================================================================

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –í–∫–ª—é—á–∞–µ—Ç dev-—Ä–µ–∂–∏–º, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∏ –≤—ã–∫–ª—é—á–∞–µ—Ç.
dev-sync:
	@make dev-mode-on
	@echo "üì¶ –ó–∞–ø—É—Å–∫ UV —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏..."
	@$(UV_COMMAND)
	@make dev-mode-off
	@echo "üöÄ DEV-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. PROD-—Ñ–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞/–∫–æ–º–º–∏—Ç–∞: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è prod-—Å—Å—ã–ª–∫–∏.
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å prod-–≤–µ—Ä—Å–∏—é.
prod-sync: dev-mode-off
	@echo "üì¶ –ó–∞–ø—É—Å–∫ UV —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å PROD-—Å—Å—ã–ª–∫–∞–º–∏ (Git-—Å—Å—ã–ª–∫–∏/PyPI)..."
	@$(UV_COMMAND)
	@echo "üî• PROD-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ú–æ–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å."
	@$(GIT_ASSUME_UNCHANGED) # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É Git

# =================================================================
# 3. –£–ü–†–ê–í–õ–ï–ù–ò–ï GIT-–ë–õ–û–ö–ò–†–û–í–ö–û–ô
# =================================================================

# –í–∫–ª—é—á–∏—Ç—å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git (–¥–ª—è Dev-—Ä–∞–±–æ—Ç—ã)
git-lock:
	@echo "üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Git-–∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è $(PROD_FILE)..."
	@$(GIT_ASSUME_UNCHANGED)
	@echo "‚úÖ Git –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ $(PROD_FILE)."

# –û—Ç–∫–ª—é—á–∏—Ç—å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∫–æ–º–º–∏—Ç–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
git-unlock:
	@echo "üîì –°–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Git-–∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è $(PROD_FILE)..."
	@$(GIT_NO_ASSUME_UNCHANGED)
	@echo "‚ùó –¢–µ–ø–µ—Ä—å Git –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ $(PROD_FILE). –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–µ—Ä–Ω—É—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É!"