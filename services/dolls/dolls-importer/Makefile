# ==============================
# Monstrino Service Makefile
# ==============================
DOTENV := .env

ifneq (,$(wildcard .env))
    include .env
    export $(shell sed 's/=.*//' .env)
endif

SERVICE_NAME := dolls-importer
PACKAGE_NAME := monstrino-models
GITHUB_TOKEN ?= none
PACKAGE_PATH := ../../../monstrino-models
PACKAGE_GIT  := git@github.com:MafiaCoconut/monstrino-models.git
PACKAGE_TAG  := 0.1.0
ENV ?= dev



SHELL := /bin/bash

.PHONY: run

run:
	cd src && poetry run uvicorn main:app --reload --port 8010 --log-config infrastructure/logging/logging_config.json

dev:
	@echo "üîß Switching $(PACKAGE_NAME) to local editable path..."
	poetry remove $(PACKAGE_NAME) || true
	poetry add --editable $(PACKAGE_PATH)
	@echo "‚úÖ $(PACKAGE_NAME) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (editable)."

# === PROD MODE: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å git tag ===
prod:
	@echo "üöÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º $(PACKAGE_NAME) —á–µ—Ä–µ–∑ SSH Git ($(PACKAGE_TAG))..."
	poetry remove $(PACKAGE_NAME) || true
	GIT_SSH_COMMAND=poetry add git+ssh://$(PACKAGE_GIT)
	@echo "‚úÖ $(PACKAGE_NAME) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ Git –ø–æ SSH."