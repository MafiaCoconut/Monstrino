---
id: adr-004-unit-of-work-and-repositories
title: ADR-004 â€” Unit of Work and Repository Abstraction
sidebar_label: ADR-004 Unit of Work
---

> **Status:** Accepted  
> **Scope:** Persistence and transaction management  
> **Audience:** Engineering / Architecture review

---

## Context

The system performs complex multi-step database operations across multiple repositories.
Early implementations created database sessions per operation, leading to unclear
transaction boundaries and inconsistent rollback behavior.

Managing sessions manually inside use cases increased cognitive load and risk of
partial writes during failures.

---

## Decision

Adopt a **Unit of Work (UoW)** pattern to explicitly define transaction boundaries.

- A Unit of Work owns the database session lifecycle
- Repositories operate within the scope of a UoW
- Transactions are committed or rolled back automatically

---

## Alternatives Considered

### 1. Per-Operation Session Management

:::danger Rejected
- Unclear transactional scope
- High risk of partial persistence
- Difficult error handling
:::

---

## Consequences

### âœ… Positive
- Clear transactional boundaries
- Consistent rollback behavior
- Simplified use-case logic

### âš ï¸ Negative
- Additional abstraction layer
- Requires discipline in repository usage

### ðŸŽ¯ Accepted Trade-off

> Explicit transaction control over minimal abstraction.

---

## Notes for Reviewers

:::note
This decision enables future extensions such as nested transactions
or distributed coordination if required.
:::